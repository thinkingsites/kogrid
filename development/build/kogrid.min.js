/*
kogrid 0.1.6 - created by Miguel Ludert
https://github.com/thinkingsites/kogrid

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),require("jquery"),require("lodash"),exports):"function"==typeof define&&define.amd?define(["knockout","jquery","lodash","exports"],a):a(ko,$,_,{})}(function(a,b,c){if(void 0===typeof a)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";if(void 0===typeof b)throw"jQuery is required, please ensure it is loaded before loading this validation plug-in";if(void 0===typeof c)throw"LoDash is required, please ensure it is loaded before loading this validation plug-in";var d=c.debounce,e=a.isObservable,f=a.observable,g=a.observableArray,h=a.computed,i=c.extend,j=window,k=c.each,l=c.isFunction,m=c.isNumber,n=c.isString,o=c.map,p=c.find,q=a.bindingHandlers,r=a.applyBindingAccessorsToNode||function(b,d,e){var f={};return c.each(d,function(a,b){f[b]=a()}),a.applyBindingsToNode(b,f,e)},s=function(a){return c.isString(a)&&document.getElementById(a)||c.isElement(a)},t=function(){},u=function(a){return function(){return this}.bind(a)},v=function(a){return e(a)?a:f(a)},w=function(a){return e(a)?a():a},x=function(a){return e(a)?a.peek():a},y=f({h:window.screen.height,w:window.screen.width}),z=function(){return"ko-grid-"+Math.round(Math.random()*Math.pow(10,10)).toString()},A=function(a,c,d){var e=H[c],f=b(e.template).appendTo(a);return e.cssClass&&f.addClass(e.cssClass),d&&f.css(d),f},B=function(a){if(a.addjQueryUiSortingIcons!==!1){var b=["ui-icon","ui-icon-triangle-2-n-s","ui-icon-triangle-1-n","ui-icon ui-icon-triangle-1-s"],d=a.addjQueryUiSortingIcons===!0,e=j.jQuery&&j.jQuery.ui||c.any(document.styleSheets,function(a){return c(a.rules).filter(function(a){return a.selectorText}).map(function(a){return a.selectorText.slice(1)}).intersection(b).value().length==b.length});(d||e)&&(a.sorting.noSortClass+=[void 0,b[0],b[1]].join(" "),a.sorting.ascendingClass+=[void 0,b[0],b[2]].join(" "),a.sorting.descendingClass+=[void 0,b[0],b[3]].join(" "))}},C=function(a,c){var d=b(a),c=parseInt(c)||c,e=b("."+H.scrollContainer.cssClass,d),f=b("."+H.headContainer.cssClass,d).outerHeight(),g=b("."+H.pager.cssClass,d).outerHeight();d.css("height",c),"auto"!==c&&"inherit"!==c?e.css("height",d.innerHeight()-f-g):e.css("height",c)},D=function(a,b){return(a.pageIndex.peek()-1)*a.pageSize.peek()+b},E=function(a,b,c){return{$columnValue:u(b),$rowIndex:u(c),$recordIndex:u(D(a,c))}},F=function(j,k,q){var r,s=this,u=g(),z=g();if(i(s,G,j),s.templates={},s.element=k,s.classes=q,s.rows=v(s.rows),s.height=v(s.height),s.total=v(s.total),s.pageSize=v(s.pageSize),s.pageIndex=v(s.pageIndex),s.url=v(s.url),s.rowClick=function(a,b){var c=this;return c?c.call(a,a,b):!0}.bind(s.rowClick),s.isString=n,s.any=h(function(){var a=w(s.rows);return!(c.isUndefined(a)||0==a.length)}),s.none=h(function(){var a=w(s.rows);return c.isUndefined(a)||0==a.length}),s.resizeHeaders=function(){var a,c,d=b("."+s.classes.head,s.element),e=b("."+s.classes.row+":first ."+s.classes.cell,s.element).map(function(){var a=b(this);return{left:a.position().left,width:a.width()}});if(d.length!=e.length)return void d.css({position:"relative",top:0,left:"auto",width:Math.floor(100/d.length)+"%"}).width();d.first().parent().height(d.first().height());for(var f=0;f<d.length;f++)a=d.eq(f),c=e[f],a.css({position:"absolute",top:0,left:c.left-1,width:c.width})},s.afterRender=d(function(){s.resizeHeaders(),C(s.element,s.height.peek()),l(s.done)&&s.done(k)},10),s.sort=function(){if(this.sortable===!0){var a=this,b=p(u.peek(),function(b){return b.key===a.key})||{key:a.key,direction:a.direction},d=c.filter(u.peek(),function(b){return b.key!=a.key});b.direction=b.direction===s.sorting.asc?s.sorting.desc:s.sorting.asc,s.sorting.allowMultiSort?(d.unshift(b),u(d)):u([b]),e(a.direction)?a.direction(b.direction):a.direction=b.direction,l(s.refresh)?s.refresh():e(s.rows)}},s.sortClass=function(a){var b=p(u(),function(b){return b.key===a.key});if(b){if(b.direction==s.sorting.asc)return s.sorting.ascendingClass;if(b.direction==s.sorting.desc)return s.sorting.descendingClass}return s.sorting.noSortClass},e(s.total)||(s.total=h({read:function(){return m(r)?r:e(s.rows)?s.rows.peek().length:c.isArray(s.rows)?s.rows.length:void 0},write:function(a){r=a}})),s.totalPages=h(function(){var a=s.total(),b=s.pageSize();return m(a)&&m(b)?Math.ceil(a/b):1}),s.first=function(){s.pageIndex(1)},s.previous=function(){var a=s.pageIndex.peek();s.pageIndex(Math.max(1,a-1))},s.next=function(){var a=s.pageIndex.peek(),b=s.totalPages.peek();s.pageIndex(Math.min(b,a+1))},s.last=function(){s.pageIndex(s.totalPages.peek())},s.goToPage=function(){var a=parseInt(s.goToPageText.peek());m(a)&&a>=1&&a<=s.totalPages.peek()?s.pageIndex(a):s.goToPageText("")},s.goToPageText=f(),y.subscribe(s.resizeHeaders),function B(a){c.forOwn(a,function(a){var b=a;e(b)&&(b.subscribe(function(){s.afterRender()}),b=b()),c.isObject(b)&&B(b)})}(j),n(s.url.peek()))s.rows=v(s.rows),s.refresh=function(){l(s.loading)&&s.loading(s.element,s.rows.peek());var d=s.pageIndex.peek(),e=s.pageSize.peek(),f=m(e)?{pageIndex:d,pageSize:e}:{pageIndex:1},g=x(s.data),h={};return h[s.sorting.sortColumn]=o(u.peek(),function(a){return a.key}),h[s.sorting.sortDirection]=o(u.peek(),function(a){return a.direction}),g=a.toJS(g),s.cleanPostData!==!1&&c.each(g,function(a,b){(c.isUndefined(a)||c.isNull(a))&&(g[b]="")}),b.ajax({url:s.url.peek(),data:i(f,h,g),type:s.type||"get",dataType:s.dataType||"json"}).done(function(a,b,c){var d=s.getRows(a,c),e=s.getTotal(a,c);s.rows(l(s.map)?o(d,s.map):d),s.total(e||d.length||0)}).always(function(){l(s.loaded)&&s.loaded(s.element,s.rows.peek())}).promise()},e(s.data)&&s.data.subscribe(s.refresh),s.url.subscribe(s.refresh),s.refresh();else{s.refresh=t;var A=v(l(s.map)?o(w(s.rows),s.map):s.rows);s.rows=h({read:function(){var a=s.pageSize(),b=(s.pageIndex()-1)*a;return A().slice(b,b+a)},write:function(a){A(l(s.map)?o(w(a),s.map):a)}}),s.total(A.peek().length)}s.pageIndex.subscribe(s.refresh),s.pageSize.subscribe(function(){var a=s.totalPages.peek(),b=s.pageIndex.peek();b>a?s.pageIndex(a):s.refresh()}),s.height.subscribe(function(a){C(s.element,a)}),s.isColumnVisible=function(a){return a=a||this,e(a.visible)||c.isBoolean(a.visible)?a.visible:!0},s.cb={visible:function(){return!c.isEmpty(s.checkbox)},value:function(a){var b=a.$index(),a=i({},a,E(s,-1,b));return s.id?a.$data[s.id]:a.$recordIndex},change:function(a,d){var e=!0,f=s.checkbox.change,g=this.$index(),h=i({},this,E(s,-1,g));if(b(d.target).is(":checked")?z.push({i:h.$recordIndex(),v:h.$data}):z.remove(function(a){return a.i==h.$recordIndex()}),!s.checkbox.multiple){var j=c.filter(z.peek(),function(a){return a.i==h.$recordIndex()});z(j)}return l(f)&&(e=f.call(h.$data,h.$data,d,h)),e===!1?!1:!0},checked:function(a){var b;return b=s.id?function(b){return b.v[s.id]==a.$data[s.id]}:function(b){return b.i==D(s,a.$index())},c.find(z(),b)},rows:z},e(s.checkedRows)&&z.subscribe(function(){var a=c.sortBy(z(),"i"),b=o(a,function(a){return a.v});s.checkedRows(b)})},G={pageSize:25,pageSizeOptions:[10,25,50,100,200,"All"],pageIndex:1,pager:!0,height:"auto",loading:function(a){b("table",a).css({opacity:.5})},loaded:function(a){b("table",a).css({opacity:1})},noRows:"No rows available",checkbox:!1,sorting:{allowMultiSort:!1,sortColumn:"sortColumn",sortDirection:"sortDirection",asc:"asc",desc:"desc",noSortClass:"ko-grid-sort-none",ascendingClass:"ko-grid-sort-asc",descendingClass:"ko-grid-sort-desc",addjQueryUiSortingIcons:"auto"},getRows:function(a){return a.rows},getTotal:function(a){return a.total}},H={headContainer:{template:"<div></div>",cssClass:"ko-grid-head-container"},head:{template:"<!-- ko foreach : { data : columns, afterRender : $root.afterRender } --><div data-bind='visible : $root.isColumnVisible($data), click : $root.sort, css : { \"ko-grid-is-sortable\" : $data.sortable } '><span data-bind='text : ($root.isString($data) ? $data : $data.title)'></span></div><!-- /ko -->",cssClass:"ko-grid-head"},sortIcon:{template:"<span type='button' data-bind='visible: $data.sortable,  css : $root.sortClass($data) '>Sort</span>",cssClass:"ko-grid-sort-icon"},scrollContainer:{template:"<div></div>",cssClass:"ko-grid-scroll-container"},table:{template:"<table cellspacing='0' cellpadding='0' data-bind='visible : any'><tbody data-bind='foreach : { data : rows, afterRender : $root.afterRender }'></tbody></table>",cssClass:"ko-grid-table"},row:{template:'<tr data-bind=\'click : $root.rowClick, css : $index()%2 ? $root.classes.row + "-even" : $root.classes.row + "-odd" \'></tr>',cssClass:"ko-grid-row"},cell:{template:"<!-- ko foreach : $root.columns --><td data-bind='kogrid$cell:$data'></td><!-- /ko -->",cssClass:"ko-grid-cell"},pager:{template:"<div></div>",cssClass:"ko-grid-pager"},first:{template:"<button type='button' data-bind='click : first, disable : pageIndex() == 1' title='First'>&lt;&lt; First</button>",cssClass:"ko-grid-first"},previous:{template:"<button type='button' data-bind='click : previous, disable : pageIndex() == 1' title='Previous'>&lt; Previous</button>",cssClass:"ko-grid-previous"},next:{template:"<button type='button' data-bind='click : next, disable : pageIndex() == totalPages()' title='Next'>Next &gt;</button>",cssClass:"ko-grid-next"},last:{template:"<button type='button' data-bind='click : last, disable : pageIndex() == totalPages()' title='Last'>Last  &gt;&gt;</button>",cssClass:"ko-grid-last"},refresh:{template:"<button type='button' data-bind='click : refresh' title='Refresh'>Refresh</button>",cssClass:"ko-grid-refresh"},pageSize:{template:"<select data-bind='options : pageSizeOptions, value : pageSize'></select>",cssClass:"ko-grid-page-size"},goToPage:{template:"<div><input type='text' data-bind='value : goToPageText'><button data-bind='click : goToPage'>Go</button></div>",cssClass:"ko-grid-go-to-page"},pagingText:{template:"<div>Page <span data-bind='text:pageIndex'></span> of <span data-bind='text: totalPages'></span></div>",cssClass:"ko-grid-paging-text"},totalText:{template:"<div><span data-bind='text:total'></span> records</div>",cssClass:"ko-grid-total-text"},noRows:{template:"<div data-bind='visible : none,html: noRows'></div>",cssClass:"ko-grid-no-rows"},checkbox:{template:"<td style='text-align:center' data-bind='visible : $root.cb.visible'><input type='checkbox' data-bind='checked : $root.cb.checked($context), value: $root.cb.value($context), event : { click : $root.cb.change.bind($context) }'/></td>",cssClass:"ko-grid-checkbox"}};q.kogrid$cell={init:function(a,b,c,d,e){var f=e.$root,g=e.$parent,h=e.$data,j=f.templates[h.template],k={visible:f.isColumnVisible.bind(h)};if(j)k.template=u({name:j,data:i({},h.data,g)});else{var m,o=n(h)?h:h.key,p=g[o],m=l(p)?p():p;k.text=u(m)}i(k,{style:u(h.style),css:u(h.css)});var q=E(e.$root,e.$parentContext.$index(),e.$index());return r(a,k,e.extend(q)),{controlsDescendantBindings:!0}}},q.kogrid={init:function(d,f){return b(function(){{var g,h=function(){var a={};return k(H,function(b,c){a[c]=b.cssClass}),a}(),j=f(),l=new F(j,d,h),m=e(l.columns)?l.columns.peek():l.columns,p=b(d).addClass("ko-grid-main").css({height:l.height.peek()}),q=A(p,"headContainer",{position:"relative"}),r=(c.isEmpty(l.checkbox)?void 0:b("<div></div>").addClass(H.head.cssClass).appendTo(q),A(q,"head")),u=(A(r,"sortIcon"),A(p,"scrollContainer")),v=A(u,"table",{position:"relative"}),x=A(v,"row");c.isEmpty(l.checkbox)?void 0:A(x,"checkbox").addClass(H.cell.cssClass),A(x,"cell"),A(u,"noRows")}l.pager&&(g=A(p,"pager"),l.refresh!==t&&A(g,"refresh"),A(g,"first"),A(g,"previous"),A(g,"pagingText"),A(g,"next"),A(g,"last"),A(g,"pageSize"),A(g,"goToPage"),A(g,"totalText"));var y=function(a){if(s(a))c.isString(a)&&(l.templates[a]=a);else{var e=z();l.templates[a]=e,b("<script type='text/html' id='"+e+"'>"+w(a)+"</script>").appendTo(d)}};c(m).filter(function(a){return n(a.template)}).each(function(a){y(a.template)}),B(l),a.applyBindingsToDescendants(l,d),j.utils=i({},j.utils,{fixHeaders:l.resizeHeaders,refresh:l.refresh,goToPage:function(a){l.pageIndex(a)},getChecked:function(a){var b=c.sortBy(l.cb.rows(),"i");return o(b,function(b){return a?b.i:b.v})},checkedAll:function(){l.cb.rows(c.times(l.total()))},uncheckAll:function(){return l.cb.rows.removeAll()},element:function(){return d}})}),{controlsDescendantBindings:!0}},options:G,templates:H},b(function(){b(j).on("resize",d(function(){var a={h:b(j).height(),w:b(j).width()},c=y.peek();(a.h!==c.h||a.w!==c.w)&&y(a)},100))})});