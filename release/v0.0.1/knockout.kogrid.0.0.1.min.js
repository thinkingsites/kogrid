"use strict";(function(){var e=function(e,t,n){var r=function(e){return t.isObservable(e)?e:t.observable(e)},i=function(e){return t.isObservable(e)?e():e},s=function(e){return t.isObservable(e)?e.peek():e},o=t.observable({h:e(window).height(),w:e(window).width()}),u=function(i,u,l){var c=this,h,d,v=t.observableArray(),m=function(){var t=e("."+c.classes.head,c.element),n=e("."+c.classes.row+":first ."+c.classes.cell,c.element),r,i;if(t.length!=n.length){return}t.parents().first().height(t.first().height());for(var s=0;s<t.length;s++){r=t.eq(s);i=n.eq(s);r.css({position:"absolute",top:0,left:i.position().left,width:i.width(),"float":"none",overflow:"hidden","white-space":"nowrap"})}};o.subscribe(m);e.extend(c,f,i);c.element=u;c.templates={};c.classes=l;c.rows=r(c.rows);c.total=r(c.total);c.pageSize=r(c.pageSize);c.pageIndex=r(c.pageIndex);c.afterRender=n.debounce(function(){m();if(n.isFunction(c.renderComplete)){c.renderComplete(u)}},100);c.isColumnVisible=function(e){if(t.isObservable(e.visible))return e.visible();else if(n.isBoolean(e.visible))return e.visible;else return true};c.sort=function(e){if(this.sortable!==true)return;var r=this,i=n.find(v.peek(),function(e,t){return e.key===r.key})||{key:r.key,direction:r.direction},s=n.filter(v.peek(),function(e){return e.key!=r.key});if(i.direction===p.asc){i.direction=p.desc}else{i.direction=p.asc}if(p.allowMultiSort){s.unshift(i);v(s)}else{v([i])}if(t.isObservable(r.direction)){r.direction(i.direction)}else{r.direction=i.direction}if(n.isFunction(c.refresh)){c.refresh()}else{if(t.isObservable(c.rows)){}else{}}};c.sortClass=function(e){console.info("sorting class");var t=n.find(v(),function(t,n){return t.key===e.key});if(t){if(t.direction==p.asc){return p.ascendingClass}else if(t.direction==p.desc){return p.descendingClass}}return p.noSortClass};c.selectCellTemplate=function(e,t){var r=c.templates[e.template],i;if(r){i={name:r,data:n.extend({},e.data,t)}}else{var s,o=n.isString(e)?e:e.key,u=t[o],s=n.isFunction(u)?u():u,i={name:a,data:s}}return i};if(!t.isObservable(c.total)){c.total=t.computed({read:function(){if(n.isNumber(h)){return h}else if(t.isObservable(c.rows)){return c.rows.peek().length}else if(n.isArray(c.rows)){return c.rows.length}},write:function(e){h=e}})}c.totalPages=t.computed(function(){var e=c.total(),t=c.pageSize();if(n.isNumber(e)&&n.isNumber(t)){return Math.ceil(e/t)}else{return 1}});c.first=function(){c.pageIndex(1)};c.previous=function(){var e=c.pageIndex.peek();c.pageIndex(Math.max(1,e-1))};c.next=function(){var e=c.pageIndex.peek(),t=c.totalPages.peek();c.pageIndex(Math.min(t,e+1))};c.last=function(){c.pageIndex(c.totalPages.peek())};c.goToPage=function(){var e=parseInt(c.goToPageText.peek());if(n.isNumber(e)&&e>=1&&e<=c.totalPages.peek())c.pageIndex(e);else c.goToPageText("")};c.goToPageText=t.observable();(function g(e){n.forOwn(e,function(e,r){var i=e;if(t.isObservable(i)){i.subscribe(function(){c.afterRender()});i=i()}if(n.isObject(i)){g(i)}})})(i);if(n.isString(c.url)){c.refresh=function(){if(n.isFunction(c.loading)){c.loading(c.element,c.rows.peek())}var t=c.pageIndex.peek(),r=c.pageSize.peek(),i=n.isNumber(r)?{pageIndex:t,pageSize:r}:{pageIndex:1},o=s(c.data),u={};u[p.sortColumn]=n.map(v.peek(),function(e){return e.key});u[p.sortDirection]=n.map(v.peek(),function(e){return e.direction});return e.ajax({url:c.url,data:n.extend(i,u,o),type:c.type||"get",dataType:c.dataType||"json"}).done(function(e){c.rows(e.rows);c.total(e.total||e.rows.length)}).always(function(){if(n.isFunction(c.loaded)){c.loaded(c.element,c.rows.peek())}}).promise()};if(t.isObservable(c.data)){c.data.subscribe(c.refresh)}c.pageIndex.subscribe(c.refresh);c.pageSize.subscribe(c.refresh);c.refresh()}},a="ko-grid-default-cell-template",f={data:undefined,columns:undefined,pageSize:25,pageSizeOptions:[10,25,50,100,200,"All"],pageIndex:1,pager:true,height:"auto",loading:function(t){e("table",t).css({opacity:.5})},loaded:function(t){e("table",t).css({opacity:1})}},l={headContainer:{template:"<div data-bind='foreach : { data : columns, afterRender : $root.afterRender }'></div>",cssClass:"ko-grid-head-container"},head:{template:"<div data-bind='visible : $root.isColumnVisible($data), click : $root.sort, css : { \"ko-grid-is-sortable\" : $data.sortable } '><span data-bind='text : (_.isString($data) ? $data : $data.title)'></span></div>",cssClass:"ko-grid-head"},sortIcon:{template:"<span type='button' data-bind='visible: $data.sortable,  css : $root.sortClass($data) '>Sort</span>",cssClass:"ko-grid-sort-icon"},scrollContainer:{template:"<div></div>",cssClass:"ko-grid-scroll-container"},table:{template:"<table cellspacing='0' cellpadding='0'><tbody data-bind='foreach : { data : rows, afterRender : $root.afterRender }'></tbody></table>",cssClass:"ko-grid-table"},row:{template:'<tr data-bind=\'foreach : $root.columns, css : $index()%2 ? $root.classes.row + "-even" : $root.classes.row + "-odd" \'></tr>',cssClass:"ko-grid-row"},cell:{template:"<td data-bind='template : $root.selectCellTemplate($data,$parent), visible : $root.isColumnVisible($data), style : $data.style, css : $data.css'></td>",cssClass:"ko-grid-cell"},pager:{template:"<div></div>",cssClass:"ko-grid-pager"},first:{template:"<button type='button' data-bind='click : first' title='First'><< First</button>",cssClass:"ko-grid-first"},previous:{template:"<button type='button' data-bind='click : previous' title='Previous'>< Previous</button>",cssClass:"ko-grid-previous"},next:{template:"<button type='button' data-bind='click : next' title='Next'>Next ></button>",cssClass:"ko-grid-next"},last:{template:"<button type='button' data-bind='click : last' title='Last'>Last  >></button>",cssClass:"ko-grid-last"},refresh:{template:"<button type='button' data-bind='click : refresh' title='Refresh'>Refresh</button>",cssClass:"ko-grid-refresh"},pageSize:{template:"<select data-bind='options : pageSizeOptions, value : pageSize'></select>",cssClass:"ko-grid-page-size"},goToPage:{template:"<div><input type='text' data-bind='value : goToPageText'><button data-bind='click : goToPage'>Go</button></div>",cssClass:"ko-grid-go-to-page"},pagingText:{template:"<div>Page <span data-bind='text:pageIndex'></span> of <span data-bind='text: totalPages'></span></div>",cssClass:"ko-grid-paging-text"},totalText:{template:"<div><span data-bind='text:total'></span> records</div>",cssClass:"ko-grid-total-text"},cellContentTemplate:{template:"<script type='text/html' id='"+a+"'><!-- ko text: $data --><!-- /ko --></script>"}},c=function(){return"ko-grid-"+Math.round(Math.random()*Math.pow(10,10)).toString()},h=function(t,n,r){var i=l[n],s=e(i.template).appendTo(t);if(i.cssClass){s.addClass(i.cssClass)}if(r){s.css(r)}return s},p={allowMultiSort:false,sortColumn:"sortColumn",sortDirection:"sortDirection",asc:"asc",desc:"desc",noSortClass:"ko-grid-sort-none",ascendingClass:"ko-grid-sort-asc",descendingClass:"ko-grid-sort-desc"};e(window).on("resize",n.debounce(function(){var t={h:e(window).height(),w:e(window).width()};var n=o.peek();if(t.h!==n.h||t.w!==n.w){o(t)}},100));t.bindingHandlers.kogrid={init:function(r,i){e(function(){var s=function(){var e={};n.each(l,function(t,n){e[n]=t.cssClass});return e}(),o=i(),a=new u(o,r,s),f=t.isObservable(a.columns)?a.columns.peek():a.columns,p=e(r).addClass(s.main),d=h(p,"headContainer",{position:"relative"}),v=h(d,"head"),m=h(v,"sortIcon"),g=h(p,"scrollContainer"),y=h(g,"table",{position:"relative"}),b=h(y,"row"),w=h(b,"cell"),E=h(p,"cellContentTemplate"),S,x,T,N,C,k,L;if(a.pager){S=h(p,"pager");if(n.isFunction(a.refresh)||a.url){h(S,"refresh")}h(S,"first");h(S,"previous");h(S,"pagingText");h(S,"next");h(S,"last");h(S,"pageSize");h(S,"goToPage");h(S,"totalText")}n(f).filter(function(e){return n.isString(e.template)}).each(function(t){if(n.isElement(document.getElementById(t.template))){return}else{var i=c();a.templates[t.template]=i;e("<script type='text/html' id='"+i+"'>"+t.template+"</script>").appendTo(r)}});t.applyBindingsToDescendants(a,r)});return{controlsDescendantBindings:true}},update:function(e,t,n,r,i){},options:f,templates:l,sorting:p}};if(typeof ko!=="undefined"&&ko.observable){e(jQuery,ko,_)}if(typeof define!=="undefined"&&define.amd){define(["jquery","knockout","_"],e)}})()